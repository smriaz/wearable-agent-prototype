name: Ping Streamlit App

on:
  schedule:
    - cron: "0 * * * *"

  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Streamlit (no redirect follow)
        run: |
          URL="https://wearable-agent-prototype.streamlit.app"
          echo "Pinging: $URL"

          code=$(curl -A "Mozilla/5.0" \
            -H "Accept: text/html" \
            -sS \
            -o /dev/null \
            -w "%{http_code}" \
            --max-time 30 \
            "$URL" || echo "000")

          echo "HTTP status: $code"

          # Accept ANY 2xx or 3xx as success
          if [[ "$code" =~ ^2|^3 ]]; then
            echo "Ping OK"
            exit 0
          else
            echo "Ping failed (HTTP $code)"
            exit 1
          fi
